<!-- Copyright by Vitali Fedulov (www.similar.pictures) 2015-2019 --> <!DOCTYPE html> <html lang="en"> <head> <title>Duplicate image finder</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <script src="js/jquery.min.js"></script> <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto"> </head> <link rel="icon" type="image/png" href="images/favicon.png"> <link rel="stylesheet" type="text/css" href="css/clustering.css"> <body> <div class="flex-container-select-files"> <div class="flex-center-horizontally"> <div> <h1 class="text-centered clustering-title">Duplicate Image Finder</h1> </div> <div id="terms-of-service"> <p class="terms-of-service-header text-centered">Terms of service and data protection</p> <div id="terms"></div> </div> <div> <p id="messages" class="hidden">Messages</p> <div id="ok-button" class="text-centered"> <div class="button">OK</div> </div> <div id="file-selector" class="text-centered"> <input class="hidden" type="file" id="filesSelected" webkitdirectory multiple accept="image/*" onchange="v49(this.files)" onclick="v11()"> <a class="button">Select a folder with images</a> </div> <div id="fast" class="fast-option"> <input type="checkbox" id="fast-option" onclick="v6()"> <div class="fast-option-text">Check here to accelerate image reads. In rare cases this option may miss some files.</div> </div> <div class="link-block text-centered"> <a class="home-cancel-link" id="cancel-link" onclick="v51()">Cancel</a> <a class="home-cancel-link" href="/">Home</a> </div> </div> </div> </div> <div class="fixed-top hidden"> <div class="fixed-top-gray"> <a href = "index.html" class="myhref"><span class="logo">Similar<span class="logo-dot">.</span>Pictures</span></a> <div class="button button-new-search">New clustering</div> </div> <div class="fixed-white-1"> <div class="progress"> <div id="progress-bar"></div> </div> <div class="progress-text"></div> </div> <div class="fixed-white-2 hidden"> <span class="found-clusters"></span> <span> (</span><span class="view-list">show/hide as list</span><span>)</span> <textarea class="textarea"></textarea> <p class="explanation"> <small class="small">Scroll down to view all clusters. Keep the browser tab open to avoid stopping the clustering process.</small> </p> </div> </div> <div id="clusters" class="clusters"></div> <script> $(document).ready(function() { $("#terms").load("tos_en.html"); v4(); $("#ok-button").hide(); $("#cancel-link").hide(); $(".button-new-search").click(v54); $("#ok-button").click(v54); }); var v79 = { v93 : 24, v38 : 12, v46 : 80000, v10 : 20*1024*1024, v73 : 0, v66 : 0, v21 : Date.now(), v78 : false, v92 : 0, v105 : [], v53 : [], v75 : [], v82 : [], v83 : [], v48 : 0, v22 : [], v34 : 50, v14 : 0.95, v133 : 10, v118 : 100, v37 : [], v26 : /(^image\/gif$)|(^image\/jpeg$)|(^image\/jpg$)|(^image\/bmp$)|(^image\/png$)|(^image\/webp$)/, v80 : "", v40 : (function () { var v20 = new Uint32Array(10); window.crypto.getRandomValues(v20); var v36 = ""; for (var i = 0; i < v20.length; i++) { v36 += v20[i].toString(36); } return v36 }) (), v100 : null, v56 : 0, v29 : false, v1 : 1000, v0 : null, v13 : "image/jpeg", v8 : 0.6, v41 : 160, v35 : '\n', v19 : '\n\n', v17 : 0, v16 : false, v9 : 0, }; var v74 = { v31 : v79.v38 * v79.v38, v117 : v79.v93 * v79.v38, v86 : v79.v93 * v79.v93, }; function v5() { return Math.floor((Date.now() - v79.v21) / 1000); } function v6() { localStorage.setItem("fast-option", $("#fast-option")[0].checked); return; } function v4() { if (localStorage.getItem("fast-option") == "true") { $("#fast-option")[0].checked = true; } return; } function v51() { v54(); } function v54() { location.reload(); $(document).ready(function(){ $(this).scrollTop(0); }); } var v39 = document.getElementById('file-selector'); v39.addEventListener('click', v27); function v27() { var v111 = document.getElementById('filesSelected'); if (!!v111.webkitdirectory == false) { alert('This browser does not support folder selection. Please try latest Chrome, Firefox or Edge.'); return; } v111.click(); } function v49(v100) { v79.v9 = 0; clearTimeout(v79.v0); $("#file-selector").hide(); v79.v100 = v100; v79.v80 = v100[0].webkitRelativePath.split("/")[0]; v79.v56 = v100.length; var v98 = 0; var v106 = 0; var v95 = new FileReader(); var v131 = new Image(); var v99 = document.createElement("canvas"); v99.width = v74.v117; v99.height = v74.v117; var v129 = v99.getContext("2d"); $(".flex-container-select-files").hide(); $(".fixed-top").show(); $(".view-list").click(v62); $(".fixed-white-2").show(); v2(); v32(v98, v106, v95, v131, v129); } function v32(v98, v106, v95, v131, v129) { if (v98 >= v79.v56) { v23(v98); return; } if (!v79.v26.test(v79.v100[v98].type) || v79.v100[v98].size > v79.v10) { v98++; v32(v98, v106, v95, v131, v129); return; } if (v79.v78 && v79.v100[v98].type == "image/jpeg" && !v79.v29) { v43(v95, v106, v79.v100[v98], function(v126) { if (v126 == null) { v79.v29 = true; v32(v98, v106, v95, v131, v129); return; } else { v131.onload = function() { v79.v17++; if (v98 < 5 || v98 % 5 === 0) { v3(v98); } v129.drawImage(v131, 0, 0, v74.v117, v74.v117); v79.v53[v106] = v52(v129.getImageData(0, 0, v74.v117, v74.v117).data); v79.v75[v106] = v131.width; v79.v82[v106] = v131.height; v79.v37[v106] = v98; v79.v73 = v106 + 1; v79.v66 = v98 + 1; URL.revokeObjectURL(v131.src); v55(v106); v98++; v106++; if (!v79.v16) { v79.v16 = true; } v79.v29 = false; v32(v98, v106, v95, v131, v129); return; }; v131.onerror = function() { URL.revokeObjectURL(v131.src); v79.v29 = true; v32(v98, v106, v95, v131, v129); return; }; v131.src = URL.createObjectURL(v126); return; } }); } else { v79.v29 = true; } if (v79.v29 == false) { return; } v95.readAsDataURL(v79.v100[v98]); v95.onerror = function() { v98++; v79.v29 = false; v32(v98, v106, v95, v131, v129); return; }; v95.onload = function(evt) { v131.src = evt.target.result; v131.onerror = function() { v98++; v79.v29 = false; v32(v98, v106, v95, v131, v129); return; }; v131.onload = function() { v79.v17++; if (v98 < 5 || v98 % 5 === 0) { v3(v98); } v129.drawImage(v131, 0, 0, v74.v117, v74.v117); v79.v53[v106] = v52(v129.getImageData(0, 0, v74.v117, v74.v117).data); v79.v75[v106] = v131.width; v79.v82[v106] = v131.height; v79.v37[v106] = v98; v79.v73 = v106 + 1; v79.v66 = v98 + 1; v55(v106); v98++; v106++; if (!v79.v16) { v79.v16 = true; } v79.v29 = false; v32(v98, v106, v95, v131, v129); return; }; }; } function v43(v95, v106, v124, v77) { v95.readAsArrayBuffer(v124.slice(0, v79.v46)); v95.onload = function (v110) { var v103 = new Uint8Array(v110.target.result), v107, v136; for (var v161 = 2; v161 < v103.length; v161++) { if (v103[v161] == 0xFF) { if (!v107) { if (v103[v161 + 1] == 0xD8) { v107 = v161; } } else { if (v103[v161 + 1] == 0xD9) { v136 = v161 + 2; break; } } } } if (v107 && v136) { v77(new Blob([v103.subarray(v107, v136)], {type:"image/jpeg"})); } else { v77(null); } }; v95.onerror = function() { v77(null); }; } function v23(v98) { if (v79.v17 < 2) { $(".fixed-top").hide(); $(".flex-container-select-files").show(); $("#messages").text("The selected folder has less than 2 images of supported types. There is nothing to compare. Please select a different folder."); $("#messages").show(); $("#file-selector").hide(); $("#cancel-link").hide(); $("#ok-button").show(); return; } $(".progress")[0].remove(); var v162 = "s"; if (v98 + 1 == 1) { v162 = ""; } v12(".progress-text", "Successfully scanned ".concat(v79.v100.length, " file", v162, ".")); if (v79.v48 == 0) { v12(".progress-text", "Zero similar images found from the successfully scanned ".concat(v79.v100.length, " file", v162, ".")); } return; } function v55(v72) { var v146 = 0, v140 = 0, v108 = 0, v115 = 0; var v60 = 0, v91 = 0, v97 = 0; var v143 = 0, v145 = 0, v138 = 0, v139 = 0; var v59 = 0, v67 = 0; var v96 = []; var v42 = []; var v44 = v64(v79.v53[v72]); loop1: for (v106 = v72 - 1; v106 >= 0; v106--) { v143 = v79.v75[v106], v145 = v79.v82[v106]; v138 = v79.v75[v72], v139 = v79.v82[v72]; if (v143 * v139 * v79.v118 + v79.v133 * v143 * v138 < v138 * v145* v79.v118 || v143 * v139 * v79.v118 > v138 * v145 * v79.v118 + v79.v133 * v143 * v138) { continue loop1; } v108 = 0; v115 = 0; for (v76 = 0; v76 < v79.v92; v76++) { v146 = v79.v53[v106][v76]; v140 = v79.v53[v72][v76]; v108 = Math.abs(v146 - v140); if (v108 <= v79.v34) { v115 += v108; } if (v108 > v79.v34) { continue loop1; } } if (v115 > v79.v92 * v79.v34 * 0.5) { continue loop1; } v60 = 0; v91 = 0, v97 = 0; for (v76 = 0; v76 < v79.v92; v76++) { v146 = v79.v53[v106][v76]; v140 = v79.v53[v72][v76]; v60 += v146 * v140; v91 += v146 * v146; v97 += v140 * v140; } if (v60 * v60 < v79.v14 * v91 * v97) { continue loop1; } v42 = v64(v79.v53[v106]); v60 = 0; v91 = 0, v97 = 0; for (v76 = 0; v76 < v79.v92; v76++) { v146 = v42[v76]; v140 = v44[v76]; v60 += v146 * v140; v91 += v146 * v146; v97 += v140 * v140; } if (v60 * v60 < v79.v14 * v91 * v97) { continue loop1; } v59 = v79.v22[v106]; v67 = v79.v22[v72]; if (typeof v59 === "undefined" && typeof v67 === "undefined") { v79.v22[v106] = v79.v48; v79.v22[v72] = v79.v48; v79.v83.push([v106, v72]); v79.v48++; v7(v79.v48 - 1); v18(v79.v48 - 1, v106); v18(v79.v48 - 1, v72); continue; } if (typeof v59 === "number" && typeof v67 === "undefined") { v96 = v79.v83[v59]; v96.push(v72); v79.v22[v72] = v59; v79.v83[v59] = v96; v18(v59, v72); continue; } if (typeof v59 === "undefined" && typeof v67 === "number") { v96 = v79.v83[v67]; v96.push(v106); v79.v22[v106] = v67; v79.v83[v67] = v96; v18(v67, v106); continue; } } v2(); return; } function v12(v24, v121) { $(v24)[0].textContent = v121; } function v2() { var v162 = "s"; if (v79.v48 == 1) { v162 = ""; } v12(".found-clusters", "Found ".concat(v79.v48, ' cluster', v162)); } function v3(v98) { if (v98 + 1 == v79.v56) { return; } v12(".progress-text", "Please wait... Reading ".concat(v98, ' from ', v79.v56, ' selected files.')); var v89 = Math.floor(100 * (v98 + 1) / v79.v56); if (v89 < 5) { v89 = 5; } var v81 = "".concat(v89, "%"); $("#progress-bar").width(v81); } function v88(v50, v33) { var v123 = document.createElement("div"); v123.className = v50; v33.appendChild(v123); return v123; } var v45 = document.getElementById("clusters"); function v7(v70) { var v65 = v88("cluster", v45); var v71 = v88("cluster-num", v65); v71.textContent = v70 + 1; var v28 = v88("cluster-content", v65); v88("cluster-imgs", v28); v88("cluster-paths", v28); } function v18(v70, v106) { var v85 = $( ".cluster-imgs" )[v70]; var v90 = v88("cluster-img-div", v85); var v131 = new Image(); v131.classList.add("cluster-img"); v90.appendChild(v131); var v57 = v88("image-size", v90); var v25 = $( ".cluster-paths" )[v70]; var v63 = v88("img-path", v25); var v124 = v79.v100[v79.v37[v106]]; v63.textContent = v124.webkitRelativePath; v30(v124, v131, v57); } function v30(v124, v131, v57) { var v95 = new FileReader(); v95.v124 = v124; v95.onload = function() { return function(e) { var v47 = new Image(); v47.src = e.target.result; var v99 = document.createElement("canvas"); var v129 = v99.getContext("2d"); v47.onload = function() { v57.textContent = "".concat(v47.width, "×", v47.height); if (v47.width >= v47.height) { v99.height = v79.v41 * 2; v99.width = ~~(v47.width * v99.height / v47.height); } else { v99.width = v79.v41 * 2; v99.height = ~~(v47.height * v99.width / v47.width); } v131.width = v99.width / 2; v131.height = v99.height / 2; v129.drawImage(v47, 0, 0, v99.width, v99.height); v131.src = v99.toDataURL(v79.v13, v79.v8); v99 = null; v129 = null; v47 = null; v95 = null; v79.v9++; }; }; } (); v95.readAsDataURL(v124); } function v62() { var v122 = ""; for (v160 = 0; v160 < v79.v48; v160++) { var v58 = v79.v83[v160]; for (v161 = 0; v161 < v58.length - 1; v161++) { v122 = v122.concat(v79.v100[v79.v37[v58[v161]]].webkitRelativePath, v79.v35); } v122 = v122.concat(v79.v100[v79.v37[v58[v161]]].webkitRelativePath, v79.v19); } v122 = v122.slice(0, -2); $(".textarea").val(v122); $(".textarea").toggleClass("textareaon"); } function v11() { $("#terms-of-service").hide(); $(".text-left").hide(); $(".vertical-center-row").toggleClass("vertical-center-narrow"); v79.v0 = setTimeout(function() { $("#messages").text('Please wait if you selected a very large number of images: it may take tens of seconds before the clustering starts.'); $("#messages").show(); $("#file-selector").hide(); v79.v78 = $("#fast-option")[0].checked; $("#fast").hide(); $("#cancel-link").show(); }, v79.v1); } function v127(v152) { return Math.floor(Math.random() * v152); } function v158(v161, v157, v119) { return v119 * v157 + v161; } function v142(v158, v119) { var v157 = Math.floor(v158 / v119); var v161 = v158 - v119 * v157; return [v161, v157]; } function v116(v87, v161, v157, v119) { var v155 = v87[v157 * (v119 * 4) + (v161 * 4) ]; var v151 = v87[v157 * (v119 * 4) + (v161 * 4) + 1]; var v156 = v87[v157 * (v119 * 4) + (v161 * 4) + 2]; var v159 = v87[v157 * (v119 * 4) + (v161 * 4) + 3]; return [v155, v151, v156, v159]; } function v68() { var v153 = 0, v149 = 0, v144 = 0, v141= 0, v69 = 0; for (v153 = 1; v153 < v79.v93 - 1; v153++) { for (v149 = 1; v149 < v79.v93 - 1; v149++) { var v15 = new Map(); for (v144 = -1; v144 < 2; v144++) { for (v141 = -1; v141 < 2; v141++) { v15.set((v149 + v141) * v79.v93 + v153 + v144, true); }} v79.v105[v69] = v15; v79.v92++; v69++; }} return; } v68(); function v61(v153, v149, v93) { if (v153 < 0 || v149 < 0 || v153 >= v93 || v149 >= v93) { return true; } return false; } function v52(v87) { var v101 = []; var v161 = 0, v157 = 0, v150 = 0, v152 = 0; var v155 = 0, v151 = 0, v156 = 0; var v132 = 0, v162 = 0; var v76 = 0; var v109 = []; var v104 = []; var v84 = []; for (v147 = 0; v147 < v79.v105.length; v147++) { v132 = 0; v162 = 0; for (var [v158, v102] of v79.v105[v147]) { v109 = v142(v158, v79.v93); v161 = v109[0]; v157 = v109[1]; for (v154 = 0; v154 < v74.v31; v154++) { v104 = v142(v154, v79.v38); v150 = v104[0]; v152 = v104[1]; v84 = v116(v87, v161 * v79.v38 + v150, v157 * v79.v38 + v152, v74.v117); v155 = v84[0]; v151 = v84[1]; v156 = v84[2]; switch (v147 % 3) { case 0: v132 += v155; v162++; break; case 1: v132 += v151; v162++; break; case 2: v132 += v155 + v151 + v156; v162 += 3; } } } v101[v76] = v132 / v162; v76++; } return v101; } function v64(v137) { var v94 = []; var v148 = v137.length; var v114 = 0; var v120 = Number.POSITIVE_INFINITY; var v128 = 0; var v113 = Number.POSITIVE_INFINITY; var v125 = 0; var v112 = Number.POSITIVE_INFINITY; for (v152 = 0; v152 < v148; v152 += 3) { if (v137[v152] > v114) { v114 = v137[v152]; } if (v137[v152] < v120) { v120 = v137[v152]; } } for (v152 = 1; v152 < v148; v152 += 3) { if (v137[v152] > v128) { v128 = v137[v152]; } if (v137[v152] < v113) { v113 = v137[v152]; } } for (v152 = 2; v152 < v148; v152 += 3) { if (v137[v152] > v125) { v125 = v137[v152]; } if (v137[v152] < v112) { v112 = v137[v152]; } } var v134 = v114 - v120; var v135 = v128 - v113; var v130 = v125 - v112; for (v152 = 0; v152 < v148; v152 += 3) { v94[v152] = (v137[v152 ] - v120) * 255 / v134; } for (v152 = 1; v152 < v148; v152 += 3) { v94[v152] = (v137[v152 ] - v113) * 255 / v135; } for (v152 = 2; v152 < v148; v152 += 3) { v94[v152] = (v137[v152 ] - v112) * 255 / v130; } return v94; } </script> </body> </html> 
